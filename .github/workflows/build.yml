name: Build & Deploy Productivity Power Hour

on:
  push:
    branches: [main]
    paths:
      - '**.twee'
      - '**.js'
      - '**.css'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1) Check out your repo
      - name: üì• Checkout
        uses: actions/checkout@v3

      # 2) Download Tweego binary
      - name: ‚öôÔ∏è Install Tweego
        run: |
          curl -L -o tweego.zip \
            https://github.com/tmedwards/tweego/releases/download/v2.1.1/tweego-2.1.1-linux64.zip
          unzip tweego.zip
          chmod +x tweego
          sudo mv tweego /usr/local/bin/

      # 3) Grab SugarCube 2.37.3 format.js
      - name: üì¶ Fetch SugarCube format
        run: |
          mkdir -p storyformats/sugarcube-2
          curl -L -o storyformats/sugarcube-2/format.js \
            https://raw.githubusercontent.com/tmedwards/sugarcube-2/2.37.3/dist/format.js

      # 4) Compile your game to docs/index.html
      - name: üß™ Compile Twine game
        run: |
          tweego story.twee \
            -j story.js \
            -c style.css \
            -f storyformats/sugarcube-2 \
            -o docs/index.html

      # 5) Commit the freshly built HTML back to main
      - name: ‚úÖ Commit compiled HTML
        run: |
          git config --global user.name  "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add docs/index.html
          # Silently skip commit if nothing changed
          git diff --cached --quiet || git commit -m "üöÄ Auto-build on ${{ github.sha }}"
          git push
        env:
          # The default token allows push to the same repo
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
